name: Version

on:
  workflow_dispatch:
    inputs:
      versionType:
        description: 'Choose the type of semantic version bump.'
        required: true
        default: 'minor'
        type: choice
        options:
          - major
          - minor
          - patch

permissions:
  actions: write
  contents: write

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 7.0.x

    - name: Bump Version
      if:  ${{ inputs.versionType }} == 'minor'
      shell: pwsh
      run: |
        $xml = [Xml] (Get-Content ./Streakathon.MAUI/Streakathon.MAUI.csproj)
        $version = [Version] $xml.Project.PropertyGroup.ApplicationDisplayVersion

        $major = $version.Major
        $minor = $version.Minor
        $patch = $version.Build

        switch("minor") 
        {
            "major"
            {
                $major = $major + 1
            }
            "minor"
            {
                $minor = $minor + 1
            }
            "patch"
            {
                $patch = $patch + 1
            }
        }

        $newVersion = "{0}.{1}.{2}" -f $major, $minor, $patch
        echo $newVersion
        $xml.Project.PropertyGroup.ApplicationDisplayVersion = $newVersion
        $xml.Save("./Streakathon.MAUI/Streakathon.MAUI.csproj")

